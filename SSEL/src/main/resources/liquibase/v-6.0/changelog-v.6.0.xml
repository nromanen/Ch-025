<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

	<changeSet id="2014-12-11-create-table-test_statistic"
		author="Vitalik">
		<comment>Create table test_statistic</comment>
		<createTable tableName="test_statistic">
			<column name="id" autoIncrement="true" type="int">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="id_test" type="int">
				<constraints nullable="false" />
			</column>
			<column name="id_user" type="int">
				<constraints nullable="false" />
			</column>
			<column name="id_group" type="int">
			</column>
			<column name="id_question" type="int">
				<constraints nullable="false" />
			</column>
			<column name="user_result" type="int">
			</column>
			<column name="max_result" type="int">
			</column>
			<column name="user_answers" type="tinyblob">
			</column>
		</createTable>
	</changeSet>

	<changeSet id="2014-12-11-foreign-key-table-test_statistic-1"
		author="Vitalik">
		<comment>Create foreign key test_statistic</comment>
	 	<sql>
			ALTER TABLE `test_statistic` ADD
			CONSTRAINT fk_test_statistic_tests FOREIGN KEY (id_test)
			REFERENCES ssel.tests (id_test) ON DELETE CASCADE ON UPDATE CASCADE;
			
			ALTER TABLE `test_statistic` ADD
			CONSTRAINT fk_test_statistic_user FOREIGN KEY (id_user)
			REFERENCES ssel.user (id) ON DELETE CASCADE ON UPDATE CASCADE;
			
			ALTER TABLE `test_statistic` ADD
			CONSTRAINT fk_test_statistic_group FOREIGN KEY (id_group)
			REFERENCES ssel.groups (id) ON DELETE CASCADE ON UPDATE CASCADE;

		</sql>
 

		<!--  <addForeignKeyConstraint constraintName="fk_test_statistic_user" referencedTableName="user" 
			baseColumnNames="id_user" baseTableName="test_statistic" referencedColumnNames="id" 
			onDelete="SET NULL" onUpdate="CASCADE" /> 
			
			<addForeignKeyConstraint constraintName="fk_test_statistic_tests" 
			referencedTableName="tests" baseColumnNames="id_test" baseTableName="test_statistic" 
			referencedColumnNames="id_test" onDelete="SET NULL" onUpdate="CASCADE" /> 
			
			<addForeignKeyConstraint constraintName="fk_test_statistic_group" referencedTableName="groups" 
			baseColumnNames="id_group" baseTableName="test_statistic" referencedColumnNames="id" 
			onDelete="SET NULL" onUpdate="CASCADE" />  -->
	</changeSet>
<!-- 
	<changeSet id="2014-12-11-create-index-table-test_statistic"
		author="Vitalik">
		<comment>Create index table test_statistic column name</comment>
		<createIndex tableName="subject" indexName="index_test_statistic_name">
			<column name="name" />
		</createIndex>
	</changeSet> -->


</databaseChangeLog>